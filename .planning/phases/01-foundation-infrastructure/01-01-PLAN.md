---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .wp-env.json
  - wp-content/themes/smartvarme-theme/style.css
  - wp-content/themes/smartvarme-theme/theme.json
  - wp-content/themes/smartvarme-theme/functions.php
  - wp-content/themes/smartvarme-theme/templates/index.html
  - wp-content/themes/smartvarme-theme/templates/single.html
  - wp-content/themes/smartvarme-theme/templates/page.html
  - wp-content/themes/smartvarme-theme/templates/archive.html
  - wp-content/themes/smartvarme-theme/templates/404.html
  - wp-content/themes/smartvarme-theme/parts/header.html
  - wp-content/themes/smartvarme-theme/parts/footer.html
  - wp-content/themes/smartvarme-theme/package.json
  - wp-content/themes/smartvarme-theme/src/index.js
  - wp-content/themes/smartvarme-theme/src/style.scss
  - wp-content/themes/smartvarme-theme/src/editor.scss
  - wp-content/themes/smartvarme-theme/.gitignore
  - wp-content/plugins/smartvarme-core/smartvarme-core.php
  - wp-content/plugins/smartvarme-core/includes/class-smartvarme-core.php
  - wp-content/plugins/smartvarme-core/includes/class-smartvarme-core-activator.php
  - wp-content/plugins/smartvarme-core/includes/class-smartvarme-core-deactivator.php
  - wp-content/plugins/smartvarme-core/uninstall.php
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Developer can start Docker environment and access WordPress at localhost:8080"
    - "Block theme is recognized by WordPress and can be activated"
    - "@wordpress/scripts build command compiles theme assets without errors"
    - "Custom smartvarme-core plugin appears in Plugins list and activates without errors"
  artifacts:
    - path: ".wp-env.json"
      provides: "Docker environment configuration with port 8080, PHP 8.3, MariaDB 10.11"
      contains: "\"port\": 8080"
    - path: "wp-content/themes/smartvarme-theme/theme.json"
      provides: "FSE configuration with design tokens"
      contains: "\"version\": 3"
    - path: "wp-content/themes/smartvarme-theme/style.css"
      provides: "Theme metadata header"
      contains: "Theme Name: Smartvarme"
    - path: "wp-content/themes/smartvarme-theme/templates/index.html"
      provides: "Required fallback template"
    - path: "wp-content/themes/smartvarme-theme/package.json"
      provides: "Build system configuration"
      contains: "wp-scripts build"
    - path: "wp-content/themes/smartvarme-theme/build/index.js"
      provides: "Compiled JavaScript (generated by build)"
    - path: "wp-content/plugins/smartvarme-core/smartvarme-core.php"
      provides: "Plugin entry point with WordPress header"
      contains: "Plugin Name: Smartvarme Core"
  key_links:
    - from: ".wp-env.json"
      to: "wp-content/themes/smartvarme-theme"
      via: "themes mapping in wp-env config"
      pattern: "smartvarme-theme"
    - from: ".wp-env.json"
      to: "wp-content/plugins/smartvarme-core"
      via: "plugins mapping in wp-env config"
      pattern: "smartvarme-core"
    - from: "wp-content/themes/smartvarme-theme/functions.php"
      to: "wp-content/themes/smartvarme-theme/build/index.asset.php"
      via: "wp_enqueue_script with asset file"
      pattern: "index\\.asset\\.php"
---

<objective>
Set up Docker-based local development environment with custom block theme, @wordpress/scripts build system, and custom plugin boilerplate.

Purpose: Establish the complete development foundation so all subsequent phases have a working WordPress environment with modern tooling. This is the infrastructure everything else builds on.

Output: Working Docker environment at localhost:8080 with activated block theme (compiled assets) and activated custom plugin.
</objective>

<execution_context>
@/Users/salesup/.claude/get-shit-done/workflows/execute-plan.md
@/Users/salesup/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Docker environment with .wp-env.json and project .gitignore</name>
  <files>
    .wp-env.json
    .gitignore
  </files>
  <action>
Create `.wp-env.json` at project root with this configuration:
- `core`: null (use latest WordPress, which is 6.8+)
- `phpVersion`: "8.3"
- `port`: 8080
- `testsPort`: 8081
- `themes`: map `./wp-content/themes/smartvarme-theme` so it auto-mounts
- `plugins`: map `./wp-content/plugins/smartvarme-core` so it auto-mounts
- `config`: set `WP_DEBUG` to true, `WP_DEBUG_LOG` to true, `SCRIPT_DEBUG` to true for development
- `env`: set `WORDPRESS_DB_HOST` to use the default wp-env MariaDB

Note: @wordpress/env uses its own Docker images. The MariaDB version is managed by wp-env. PHP 8.3 is set via the `phpVersion` field. There is no separate `mysqlPort` in .wp-env.json schema -- omit it.

Create a project-level `.gitignore` that excludes:
- `node_modules/`
- `wp-content/themes/smartvarme-theme/build/`
- `wp-content/themes/smartvarme-theme/node_modules/`
- `*.log`
- `log*.txt`
- `.DS_Store`
- `wp-admin/`
- `wp-includes/`
- `wp-*.php` (core files)
- `index.php` (core)
- `xmlrpc.php`
- `license.txt`
- `readme.html`
- `.htaccess`
- `.user.ini`
- `error_log`
- `smartvarme_wp_zmmon.sql` (large database dump, do not commit)
- `adminer-*.php`
- `wordfence-waf.php`
- `wp-config.php`
- `wp-config-backup-*.php`
- `find-duplicate-sku.php`
- `info.php`

Keep tracked: `.wp-env.json`, `.gitignore`, `.planning/`, `.claude/`, `wp-content/themes/smartvarme-theme/`, `wp-content/plugins/smartvarme-core/`

Install @wordpress/env globally if not already installed: `npm install -g @wordpress/env`

Do NOT start the Docker environment yet -- Plan 02 handles database import which requires Docker running, and the theme/plugin must exist first.
  </action>
  <verify>
Verify .wp-env.json is valid JSON: `node -e "JSON.parse(require('fs').readFileSync('.wp-env.json', 'utf8')); console.log('Valid JSON')"` from project root.

Verify .gitignore exists and contains key patterns: `grep 'node_modules' .gitignore && grep 'smartvarme_wp_zmmon.sql' .gitignore`
  </verify>
  <done>
.wp-env.json exists with port 8080, PHP 8.3, theme and plugin mappings. .gitignore excludes core WordPress files, logs, and database dump while keeping custom theme, plugin, and planning files tracked.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create block theme skeleton with theme.json v3, FSE templates, and @wordpress/scripts build system</name>
  <files>
    wp-content/themes/smartvarme-theme/style.css
    wp-content/themes/smartvarme-theme/theme.json
    wp-content/themes/smartvarme-theme/functions.php
    wp-content/themes/smartvarme-theme/templates/index.html
    wp-content/themes/smartvarme-theme/templates/single.html
    wp-content/themes/smartvarme-theme/templates/page.html
    wp-content/themes/smartvarme-theme/templates/archive.html
    wp-content/themes/smartvarme-theme/templates/404.html
    wp-content/themes/smartvarme-theme/parts/header.html
    wp-content/themes/smartvarme-theme/parts/footer.html
    wp-content/themes/smartvarme-theme/package.json
    wp-content/themes/smartvarme-theme/src/index.js
    wp-content/themes/smartvarme-theme/src/style.scss
    wp-content/themes/smartvarme-theme/src/editor.scss
    wp-content/themes/smartvarme-theme/.gitignore
  </files>
  <action>
Create the complete block theme directory structure at `wp-content/themes/smartvarme-theme/`.

**style.css** - Theme metadata header (required by WordPress):
```
/*
Theme Name: Smartvarme
Theme URI: https://smartvarme.no
Author: Smartvarme
Author URI: https://smartvarme.no
Description: Custom block theme for Smartvarme heating and fireplace products
Version: 1.0.0
Requires at least: 6.8
Tested up to: 6.8
Requires PHP: 8.3
License: GPL-2.0-or-later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: smartvarme
*/
```
No additional CSS in this file -- all styling goes through theme.json and build system.

**theme.json** - Version 3, FSE configuration. Include:
- `$schema`: "https://schemas.wp.org/trunk/theme.json"
- `version`: 3
- `settings.appearanceTools`: true
- `settings.useRootPaddingAwareAlignments`: true
- `settings.color.palette`: primary (#1a1a1a), secondary (#767676), accent (#e63946 -- Smartvarme's red-ish brand feel for heating products), background (#ffffff), surface (#f8f9fa)
- `settings.color.custom`: true
- `settings.typography.fontSizes`: small (0.875rem), medium (1rem), large (1.25rem), x-large (1.5rem), xx-large (2.25rem)
- `settings.typography.fluid`: true
- `settings.typography.lineHeight`: true
- `settings.spacing.units`: ["px", "em", "rem", "vh", "vw", "%"]
- `settings.spacing.padding`: true
- `settings.spacing.margin`: true
- `settings.layout.contentSize`: "800px"
- `settings.layout.wideSize`: "1200px"
- `styles.color.background`: "var(--wp--preset--color--background)"
- `styles.color.text`: "var(--wp--preset--color--primary)"
- `styles.typography.fontSize`: "var(--wp--preset--font-size--medium)"
- `styles.typography.lineHeight`: "1.6"
- `styles.blocks.core/heading.typography.fontWeight`: "700"

Note: Color palette is a starting point -- will be refined in Phase 5 (Design). Keep it minimal now.

**templates/index.html** (required fallback):
```html
<!-- wp:template-part {"slug":"header","area":"header"} /-->
<!-- wp:group {"tagName":"main","layout":{"type":"constrained"}} -->
<main class="wp-block-group">
  <!-- wp:query {"queryId":1,"query":{"perPage":10,"pages":0,"offset":0,"postType":"post","order":"desc","orderBy":"date"}} -->
  <div class="wp-block-query">
    <!-- wp:post-template -->
      <!-- wp:post-title {"isLink":true} /-->
      <!-- wp:post-excerpt /-->
    <!-- /wp:post-template -->
    <!-- wp:query-pagination -->
      <!-- wp:query-pagination-previous /-->
      <!-- wp:query-pagination-numbers /-->
      <!-- wp:query-pagination-next /-->
    <!-- /wp:query-pagination -->
  </div>
  <!-- /wp:query -->
</main>
<!-- /wp:group -->
<!-- wp:template-part {"slug":"footer","area":"footer"} /-->
```

**templates/single.html**: Header + main with post-title, post-date, post-content + footer.
**templates/page.html**: Header + main with post-title, post-content + footer.
**templates/archive.html**: Header + main with query-title, query loop + footer.
**templates/404.html**: Header + main with "Page not found" heading and paragraph + footer.

**parts/header.html**: Site title block wrapped in header tag.
**parts/footer.html**: Paragraph with copyright text wrapped in footer tag.

**package.json**:
```json
{
  "name": "smartvarme-theme",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "start": "wp-scripts start",
    "build": "wp-scripts build",
    "format": "wp-scripts format",
    "lint:js": "wp-scripts lint-js",
    "lint:css": "wp-scripts lint-style"
  },
  "devDependencies": {
    "@wordpress/scripts": "^30.0.0"
  }
}
```

**src/index.js**: Entry point. Just import the style:
```js
import './style.scss';
```

**src/style.scss**: Minimal placeholder:
```scss
/* Frontend styles - compiled by @wordpress/scripts */
/* Design system styles will be added in Phase 5 */
```

**src/editor.scss**: Minimal placeholder:
```scss
/* Editor styles - compiled by @wordpress/scripts */
```

**functions.php**: Enqueue compiled assets from build/ directory. Use the pattern from research (check for build/index.asset.php existence, enqueue script with dependencies from asset file, enqueue style). Also enqueue editor styles via `enqueue_block_editor_assets` hook. See 01-RESEARCH.md Code Examples section for exact pattern.

**Theme .gitignore** (`wp-content/themes/smartvarme-theme/.gitignore`):
```
node_modules/
build/
```

After creating all files, run `npm install` and `npm run build` in the theme directory to verify the build system works.
  </action>
  <verify>
1. Theme directory exists: `ls wp-content/themes/smartvarme-theme/theme.json`
2. theme.json is valid JSON with version 3: `node -e "const t = JSON.parse(require('fs').readFileSync('wp-content/themes/smartvarme-theme/theme.json', 'utf8')); console.log('version:', t.version)"`
3. Build succeeds: `cd wp-content/themes/smartvarme-theme && npm run build`
4. Build output exists: `ls wp-content/themes/smartvarme-theme/build/index.js wp-content/themes/smartvarme-theme/build/index.asset.php`
5. Required templates exist: `ls wp-content/themes/smartvarme-theme/templates/index.html`
  </verify>
  <done>
Block theme skeleton exists with theme.json v3 configuration, all required FSE templates (index, single, page, archive, 404), template parts (header, footer), and @wordpress/scripts build system that compiles successfully producing build/index.js and build/index.asset.php.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create smartvarme-core plugin boilerplate</name>
  <files>
    wp-content/plugins/smartvarme-core/smartvarme-core.php
    wp-content/plugins/smartvarme-core/includes/class-smartvarme-core.php
    wp-content/plugins/smartvarme-core/includes/class-smartvarme-core-activator.php
    wp-content/plugins/smartvarme-core/includes/class-smartvarme-core-deactivator.php
    wp-content/plugins/smartvarme-core/uninstall.php
  </files>
  <action>
Create the custom plugin at `wp-content/plugins/smartvarme-core/`.

**smartvarme-core.php** - Main plugin file using the WordPress Plugin Boilerplate pattern from research:
- Plugin header: Name "Smartvarme Core", description "Core business logic for Smartvarme site", version 1.0.0, text domain "smartvarme-core"
- Security check: `if ( ! defined( 'WPINC' ) ) { die; }`
- Constants: SMARTVARME_CORE_VERSION, SMARTVARME_CORE_PATH, SMARTVARME_CORE_URL
- Activation/deactivation hooks registered
- Main `run_smartvarme_core()` function that loads and runs the core class
- Follow the exact pattern from 01-RESEARCH.md Code Examples section

**includes/class-smartvarme-core.php** - Main plugin class:
- Constructor: empty (ready for future hooks/filters)
- `run()` method: empty (placeholder for future initialization)
- This is intentionally minimal -- functionality comes in later phases

**includes/class-smartvarme-core-activator.php** - Activation class:
- Static `activate()` method: empty body (placeholder)

**includes/class-smartvarme-core-deactivator.php** - Deactivation class:
- Static `deactivate()` method: empty body (placeholder)

**uninstall.php** - Cleanup file:
- Security check: `if ( ! defined( 'WP_UNINSTALL_PLUGIN' ) ) { die; }`
- Empty body (no cleanup needed yet)

This plugin intentionally has NO functionality. Phase 1 success criteria is only "plugin exists and activates without errors." Business logic will be added in later phases per the plugin vs. theme decision matrix in research.
  </action>
  <verify>
1. Plugin file exists with correct header: `head -5 wp-content/plugins/smartvarme-core/smartvarme-core.php`
2. PHP syntax check: `php -l wp-content/plugins/smartvarme-core/smartvarme-core.php`
3. All includes exist: `ls wp-content/plugins/smartvarme-core/includes/`
4. Security checks present: `grep "WPINC" wp-content/plugins/smartvarme-core/smartvarme-core.php`
  </verify>
  <done>
Custom smartvarme-core plugin exists with WordPress Plugin Boilerplate structure, proper headers, activation/deactivation hooks, security checks, and passes PHP syntax validation. Plugin has no functionality -- ready for business logic in later phases.
  </done>
</task>

</tasks>

<verification>
All three artifacts verified independently:
1. `.wp-env.json` is valid JSON with correct port, PHP version, and theme/plugin mappings
2. Block theme has valid theme.json v3, all required templates, and `npm run build` succeeds
3. Plugin passes PHP syntax check and has correct WordPress headers

Note: Docker is NOT started in this plan. Plan 02 starts Docker and performs database import.
</verification>

<success_criteria>
1. `.wp-env.json` exists and is valid JSON with port 8080 and PHP 8.3 configuration
2. `wp-content/themes/smartvarme-theme/theme.json` exists with version 3
3. `npm run build` in theme directory completes without errors
4. `wp-content/themes/smartvarme-theme/build/index.js` and `build/index.asset.php` exist after build
5. `wp-content/plugins/smartvarme-core/smartvarme-core.php` exists and passes `php -l` syntax check
6. `.gitignore` excludes core WordPress files and database dump
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
