---
phase: 02-content-system-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - wp-content/themes/smartvarme-theme/theme.json
  - wp-content/themes/smartvarme-theme/functions.php
  - wp-content/themes/smartvarme-theme/patterns/faq-section.php
  - wp-content/themes/smartvarme-theme/patterns/hero-section.php
  - wp-content/themes/smartvarme-theme/patterns/contact-cta.php
  - wp-content/themes/smartvarme-theme/patterns/blog-card-grid.php
  - wp-content/themes/smartvarme-theme/patterns/product-features.php
autonomous: true

must_haves:
  truths:
    - "Block patterns appear in the editor pattern inserter under Smartvarme category"
    - "FAQ section pattern inserts a native WordPress 6.9 accordion with placeholder Q&A items"
    - "Hero section pattern inserts a full-width hero with heading, paragraph, and button"
    - "CTA pattern inserts a styled call-to-action block with Norwegian text"
    - "Blog card grid pattern inserts a query loop showing post cards"
    - "Design tokens in theme.json constrain editor to brand palette only"
    - "Synced patterns can be created and edited in one place, updates propagate globally"
  artifacts:
    - path: "wp-content/themes/smartvarme-theme/patterns/faq-section.php"
      provides: "FAQ accordion pattern using native WP 6.9 accordion block"
      contains: "wp:details"
    - path: "wp-content/themes/smartvarme-theme/patterns/hero-section.php"
      provides: "Full-width hero section pattern"
      contains: "wp:cover"
    - path: "wp-content/themes/smartvarme-theme/patterns/contact-cta.php"
      provides: "Contact CTA pattern with Norwegian strings"
      contains: "Kontakt oss"
    - path: "wp-content/themes/smartvarme-theme/patterns/blog-card-grid.php"
      provides: "Blog post grid layout pattern"
      contains: "wp:query"
    - path: "wp-content/themes/smartvarme-theme/patterns/product-features.php"
      provides: "Product features highlight pattern"
      contains: "wp:columns"
    - path: "wp-content/themes/smartvarme-theme/theme.json"
      provides: "Locked design tokens for content system"
      contains: "custom.*false"
  key_links:
    - from: "wp-content/themes/smartvarme-theme/patterns/*.php"
      to: "WordPress pattern inserter"
      via: "File-based pattern registration (WordPress auto-discovers patterns/ directory)"
      pattern: "Title:|Categories:"
    - from: "wp-content/themes/smartvarme-theme/functions.php"
      to: "Pattern categories"
      via: "register_block_pattern_category on init hook"
      pattern: "register_block_pattern_category"
    - from: "wp-content/themes/smartvarme-theme/theme.json"
      to: "Block editor UI"
      via: "Design token constraints"
      pattern: "custom.*false"
---

<objective>
Create block pattern infrastructure, 5 content patterns, and synced pattern support for the Smartvarme theme.

Purpose: Enable content editors to create FAQ articles, blog posts, and landing pages using pre-built Gutenberg block patterns without developer help. Synced patterns allow repeating elements (contact CTAs, disclaimers) to be edited in one place and update globally. This is the foundation for all Phase 2 content work.

Output: 5 block patterns registered in theme patterns/ directory, pattern categories registered, theme.json updated with locked content design tokens, synced pattern feature enabled and documented.
</objective>

<execution_context>
@/Users/salesup/.claude/get-shit-done/workflows/execute-plan.md
@/Users/salesup/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-system-migration/02-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
@wp-content/themes/smartvarme-theme/theme.json
@wp-content/themes/smartvarme-theme/functions.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update theme.json with locked content design tokens and register pattern categories</name>
  <files>
    wp-content/themes/smartvarme-theme/theme.json
    wp-content/themes/smartvarme-theme/functions.php
  </files>
  <action>
    **theme.json updates:**
    1. Set `"custom": false` under color settings to lock palette to brand colors only
    2. Set `"defaultPalette": false` to remove WordPress default colors from editor
    3. Add gold button color to palette: `{"slug": "gold", "color": "#f7a720", "name": "Gold"}` (per Phase 1 brand decision)
    4. Add `"customFontSize": false` under typography to lock to defined sizes
    5. Add spacing sizes array with small (1rem), medium (2rem), large (4rem) presets
    6. Set `"customSpacingSize": false` to lock spacing to presets
    7. Keep existing contentSize (1140px) and wideSize (1400px) from Phase 1

    **functions.php updates:**
    Add a function `smartvarme_register_pattern_categories()` hooked to `init` that registers these pattern categories:
    - `smartvarme` (label: "Smartvarme") - main category for all custom patterns
    - `smartvarme-faq` (label: "FAQ") - FAQ-specific patterns
    - `smartvarme-cta` (label: "Oppfordring til handling") - CTA patterns

    Use `register_block_pattern_category()` for each. Add after existing code in functions.php, do NOT replace existing functions.

    NOTE: WordPress auto-discovers patterns from the theme `patterns/` directory (since WP 6.0). No need to call `register_block_pattern()` manually -- just place PHP files in patterns/ with the correct header comments.
  </action>
  <verify>
    1. `python3 -c "import json; json.load(open('wp-content/themes/smartvarme-theme/theme.json'))"` succeeds (valid JSON)
    2. `php -l wp-content/themes/smartvarme-theme/functions.php` passes syntax check
    3. Grep theme.json for `"custom": false` (should appear for color)
    4. Grep functions.php for `register_block_pattern_category` (should find 3 registrations)
  </verify>
  <done>
    theme.json constrains editor to brand palette (no custom colors/sizes), gold button color available, pattern categories registered for Smartvarme patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 5 block patterns in theme patterns/ directory</name>
  <files>
    wp-content/themes/smartvarme-theme/patterns/faq-section.php
    wp-content/themes/smartvarme-theme/patterns/hero-section.php
    wp-content/themes/smartvarme-theme/patterns/contact-cta.php
    wp-content/themes/smartvarme-theme/patterns/blog-card-grid.php
    wp-content/themes/smartvarme-theme/patterns/product-features.php
  </files>
  <action>
    Create the `patterns/` directory inside the theme. Each pattern file uses the WordPress file-based pattern registration format with header comments.

    **Pattern file format** (each file):
    ```php
    <?php
    /**
     * Title: Pattern Name
     * Slug: smartvarme/pattern-slug
     * Categories: smartvarme, other-category
     * Keywords: keyword1, keyword2
     * Description: Brief description
     */
    ?>
    <!-- Block markup here -->
    ```

    **1. faq-section.php** — FAQ accordion using native WordPress 6.9 accordion block
    - Categories: `smartvarme, smartvarme-faq, text`
    - Keywords: `faq, accordion, sporsmal`
    - Content: A group block (constrained layout) containing:
      - H2 heading: "Ofte stilte sporsmal"
      - A `<!-- wp:details -->` block structure with 3 placeholder FAQ items
      - Each item: `<details>` with `<summary>` containing the question as text, and a paragraph block for the answer
      - IMPORTANT: Use `wp:details` block (the native WordPress Details block available since 6.3). Do NOT use `wp:core/accordion` -- that block name from the research may not be the actual registered name. The native Details block is the safe choice and renders as accessible `<details><summary>` HTML.
      - Structure each FAQ item as:
        ```
        <!-- wp:details -->
        <details class="wp-block-details"><summary>Sporsmalet her?</summary>
        <!-- wp:paragraph -->
        <p>Svaret her...</p>
        <!-- /wp:paragraph -->
        </details>
        <!-- /wp:details -->
        ```
      - Include 3 placeholder FAQ items with Norwegian text about heating products

    **2. hero-section.php** — Full-width hero section
    - Categories: `smartvarme, featured`
    - Keywords: `hero, banner, forside`
    - Content: A Cover block (`wp:cover`) with:
      - Full-width alignment (`"align":"full"`)
      - Dark overlay (dimRatio: 50)
      - Placeholder background color (surface color)
      - Inner content: H1 heading, paragraph, and a Buttons block with gold-colored CTA button
      - All text in Norwegian (e.g., "Varme og komfort til ditt hjem")

    **3. contact-cta.php** — Contact call-to-action
    - Categories: `smartvarme, smartvarme-cta, call-to-action`
    - Keywords: `kontakt, cta, hjelp`
    - Content: A Group block with gold background color and constrained layout containing:
      - H2: "Trenger du hjelp?"
      - Paragraph: "Vare eksperter er klare til a hjelpe deg med a velge riktig varmepumpe."
      - Buttons block with outline-style button: "Kontakt oss"
      - Use theme palette color references (backgroundColor: "gold")

    **4. blog-card-grid.php** — Blog post grid
    - Categories: `smartvarme, posts`
    - Keywords: `blogg, artikler, innlegg`
    - Content: A Query Loop block (`wp:query`) configured for:
      - 6 posts per page, ordered by date descending
      - Post template with: featured image, post title (linked), post excerpt, post date
      - Columns layout (3 columns on desktop via `"displayLayout":{"type":"flex","columns":3}`)
      - Pagination at bottom

    **5. product-features.php** — Product features highlight
    - Categories: `smartvarme, featured`
    - Keywords: `produkter, funksjoner, fordeler`
    - Content: A Columns block (`wp:columns`) with 3 columns, each containing:
      - An icon placeholder (emoji or dashicon via paragraph)
      - H3 heading (e.g., "Energieffektiv", "Enkel montering", "Lang levetid")
      - Paragraph with description
      - Use surface background color for the group

    All text content MUST be in Norwegian. Use proper Norwegian characters (ae, o-slash, a-ring) in the actual block markup.
  </action>
  <verify>
    1. `ls wp-content/themes/smartvarme-theme/patterns/` shows 5 .php files
    2. `php -l` passes on each pattern file
    3. Each file contains the required `Title:` and `Slug:` header comments
    4. `grep -l "wp:details" wp-content/themes/smartvarme-theme/patterns/faq-section.php` finds the details block
    5. `grep -l "wp:cover" wp-content/themes/smartvarme-theme/patterns/hero-section.php` finds the cover block
    6. `grep -l "wp:query" wp-content/themes/smartvarme-theme/patterns/blog-card-grid.php` finds the query block
  </verify>
  <done>
    5 block patterns exist in patterns/ directory, each with correct WordPress file-based registration headers, Norwegian content, and using only native WordPress blocks (no third-party block dependencies).
  </done>
</task>

<task type="auto">
  <name>Task 3: Enable and document synced pattern support for repeating elements</name>
  <files>
    wp-content/themes/smartvarme-theme/functions.php
  </files>
  <action>
    **Enable synced pattern support:**

    WordPress 6.3+ natively supports synced patterns (formerly called "reusable blocks"). No custom code needed - the feature is built into core. However, we should ensure the theme supports it properly and create documentation for content editors.

    **In functions.php, add support declaration:**

    Add these theme supports to ensure synced patterns work correctly:
    ```php
    // Enable synced pattern support (WordPress 6.3+)
    add_theme_support( 'wp-block-styles' );
    add_theme_support( 'editor-styles' );
    ```

    These are likely already added from Phase 1, but verify they exist. If missing, add them in the `smartvarme_theme_setup()` function.

    **Create starter synced patterns via WP-CLI:**

    Create 2 synced patterns that will serve as examples for content editors:

    1. **Contact CTA synced pattern** - A contact form call-to-action that appears across multiple product pages
    2. **Product Disclaimer synced pattern** - Legal disclaimer text that appears on all product-related pages

    Use WP-CLI to create these as "wp_block" post type (WordPress's internal storage for synced patterns):

    ```bash
    # Create contact CTA synced pattern
    npx @wordpress/env run cli wp post create \
      --post_type=wp_block \
      --post_title="Contact CTA - Synced" \
      --post_status=publish \
      --post_content='<!-- wp:group {"backgroundColor":"gold","layout":{"type":"constrained"}} -->
<div class="wp-block-group has-gold-background-color has-background">
  <!-- wp:heading {"level":3} -->
  <h3>Trenger du hjelp med å velge?</h3>
  <!-- /wp:heading -->

  <!-- wp:paragraph -->
  <p>Våre eksperter er klare til å hjelpe deg. Kontakt oss for gratis rådgivning.</p>
  <!-- /wp:paragraph -->

  <!-- wp:buttons -->
  <div class="wp-block-buttons">
    <!-- wp:button {"className":"is-style-outline"} -->
    <div class="wp-block-button is-style-outline">
      <a class="wp-block-button__link" href="/kontakt-oss">Kontakt oss</a>
    </div>
    <!-- /wp:button -->
  </div>
  <!-- /wp:buttons -->
</div>
<!-- /wp:group -->'

    # Create product disclaimer synced pattern
    npx @wordpress/env run cli wp post create \
      --post_type=wp_block \
      --post_title="Produktansvarsfraskrivelse - Synced" \
      --post_status=publish \
      --post_content='<!-- wp:group {"backgroundColor":"surface","layout":{"type":"constrained"}} -->
<div class="wp-block-group has-surface-background-color has-background">
  <!-- wp:paragraph {"fontSize":"small"} -->
  <p class="has-small-font-size"><strong>Viktig informasjon:</strong> Alle produktspesifikasjoner er oppgitt av produsenten. Vi tar forbehold om trykkfeil og endringer. Kontakt oss for å bekrefte spesifikasjoner før kjøp.</p>
  <!-- /wp:paragraph -->
</div>
<!-- /wp:group -->'
    ```

    **Document synced pattern workflow:**

    After creating the starter patterns, verify they appear in the editor:
    - Open block editor: Click "+" -> "Patterns" tab -> "My patterns" section
    - Synced patterns have a sync icon and "Edit" button
    - Editing a synced pattern updates all instances across the site

    IMPORTANT: Per research (Pattern 2 in Architecture Patterns section), synced patterns are created via the WordPress UI (Block Editor → Patterns → Create Pattern → Enable "Sync"). The WP-CLI approach above creates the initial examples. Content editors will create additional synced patterns through the UI as needed.

    Use cases for synced patterns (document in SUMMARY):
    - Contact form CTAs that appear on multiple pages
    - Legal disclaimers for product pages
    - Promotional banners for seasonal campaigns
    - Newsletter signup forms
    - Social media follow buttons
  </action>
  <verify>
    1. `grep -q "add_theme_support.*wp-block-styles" wp-content/themes/smartvarme-theme/functions.php` (theme supports block styles)
    2. Run: `npx @wordpress/env run cli wp post list --post_type=wp_block --format=count` returns at least 2 (the synced patterns created)
    3. Run: `npx @wordpress/env run cli wp post list --post_type=wp_block --fields=ID,post_title` shows "Contact CTA - Synced" and "Produktansvarsfraskrivelse - Synced"
    4. Open http://localhost:8080/wp-admin/post-new.php?post_type=page in browser, click "+", go to "Patterns" tab, verify "My patterns" section exists
  </verify>
  <done>
    Theme supports synced patterns. Two starter synced patterns created (Contact CTA, Product Disclaimer) as examples. Synced patterns are accessible via block editor pattern inserter under "My patterns". Content editors can create/edit synced patterns via UI, and edits propagate to all instances.
  </done>
</task>

</tasks>

<verification>
1. All 5 pattern files exist in wp-content/themes/smartvarme-theme/patterns/
2. theme.json is valid JSON with locked design tokens
3. functions.php has pattern category registrations and passes PHP syntax check
4. Pattern files use correct header comment format for auto-discovery
5. No references to Kadence blocks or other third-party blocks in patterns
6. All user-facing text is in Norwegian
7. Synced patterns feature enabled and 2 starter patterns created
8. Synced patterns appear in block editor pattern inserter
</verification>

<success_criteria>
- 5 pattern PHP files in patterns/ directory with correct registration headers
- theme.json locks colors and font sizes to brand presets (custom: false)
- Gold button color (#f7a720) available in palette
- Pattern categories registered (smartvarme, smartvarme-faq, smartvarme-cta)
- All patterns use exclusively native WordPress blocks
- All pattern content in Norwegian
- Synced pattern support verified (theme supports, 2 starter patterns created)
- Synced patterns accessible in block editor under "My patterns"
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-system-migration/02-01-SUMMARY.md`
</output>
