---
phase: 02-content-system-migration
plan: 03
type: execute
wave: 3
depends_on: ["02-02", "02-04"]
files_modified:
  - wp-content/themes/smartvarme-theme/templates/single.html
  - wp-content/themes/smartvarme-theme/templates/page-faq.html
autonomous: false

must_haves:
  truths:
    - "All 9 blog posts are accessible at their original URLs"
    - "FAQ page is accessible at /faq/ with all 6 FAQ items visible"
    - "FAQ schema markup validates (contains FAQPage type with Question entities)"
    - "Content editor can insert FAQ pattern from pattern inserter"
    - "Content editor can insert blog card grid pattern from pattern inserter"
    - "Blog posts and FAQ pages render without PHP errors or broken layouts"
    - "Synced patterns can be created and edited, changes propagate to all instances"
    - "Product comparison block appears in inserter and renders comparison table"
    - "Energy calculator block appears in inserter and performs calculations"
  artifacts:
    - path: "verification-output"
      provides: "URL accessibility report for all content"
      contains: "HTTP 200"
  key_links:
    - from: "Blog post URLs"
      to: "single.html template"
      via: "WordPress template hierarchy"
      pattern: "/%postname%/"
    - from: "/faq/ URL"
      to: "page-faq.html template"
      via: "WordPress page-{slug} template hierarchy"
      pattern: "page-faq"
    - from: "Block patterns"
      to: "Pattern inserter UI"
      via: "WordPress auto-discovery of patterns/ directory"
      pattern: "patterns/*.php"
    - from: "Custom blocks"
      to: "Block editor UI"
      via: "Block registration in smartvarme-core plugin"
      pattern: "smartvarme/*"
---

<objective>
Verify all content URLs work, patterns are accessible in editor, FAQ schema validates, synced patterns function correctly, and custom blocks render properly. Human verification of complete content editing workflow.

Purpose: Ensure the Phase 2 success criteria are met: content editors can create FAQ/blog content using patterns, synced patterns update globally, custom domain blocks work, existing content is accessible at original URLs, and FAQ schema markup is valid.

Output: Verified URL accessibility, working pattern inserter, validated FAQ schema, functional synced patterns, working custom blocks, human-approved content editing experience.
</objective>

<execution_context>
@/Users/salesup/.claude/get-shit-done/workflows/execute-plan.md
@/Users/salesup/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-system-migration/02-RESEARCH.md
@.planning/phases/02-content-system-migration/02-01-SUMMARY.md
@.planning/phases/02-content-system-migration/02-02-SUMMARY.md
@.planning/phases/02-content-system-migration/02-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify all content URLs, FAQ schema, synced patterns, and custom blocks</name>
  <files></files>
  <action>
    **Step 1: Verify all blog post URLs**

    Run WP-CLI to get all published post URLs, then check each returns HTTP 200:

    ```bash
    # Get all published post URLs
    npx @wordpress/env run cli wp post list --post_type=post --post_status=publish --fields=ID,post_name --format=csv

    # For each post, verify the URL works
    # Posts use /%postname%/ structure, so URL is http://localhost:8080/{post_name}/
    npx @wordpress/env run cli wp eval "
      \$posts = get_posts(['post_type' => 'post', 'post_status' => 'publish', 'numberposts' => -1]);
      foreach (\$posts as \$post) {
        \$url = get_permalink(\$post->ID);
        \$response = wp_remote_get(\$url);
        \$code = wp_remote_retrieve_response_code(\$response);
        echo \$post->post_name . ' => ' . \$code . PHP_EOL;
      }
    "
    ```

    **Step 2: Verify FAQ page URL**

    ```bash
    npx @wordpress/env run cli wp eval "
      \$response = wp_remote_get('http://localhost/faq/');
      echo 'FAQ page: ' . wp_remote_retrieve_response_code(\$response) . PHP_EOL;
    "
    ```

    **Step 3: Verify key content pages**

    Check that important pages (Tips & Info, Inspirasjon, Kontakt oss, Om oss) also return 200.

    ```bash
    npx @wordpress/env run cli wp eval "
      \$pages = ['tips-info', 'inspirasjon', 'kontakt-oss', 'om-oss', 'forside', 'faq'];
      foreach (\$pages as \$slug) {
        \$page = get_page_by_path(\$slug);
        if (\$page) {
          \$url = get_permalink(\$page->ID);
          \$response = wp_remote_get(\$url);
          \$code = wp_remote_retrieve_response_code(\$response);
          echo \$slug . ' => ' . \$code . ' (' . \$url . ')' . PHP_EOL;
        } else {
          echo \$slug . ' => NOT FOUND' . PHP_EOL;
        }
      }
    "
    ```

    **Step 4: Verify FAQ schema output**

    ```bash
    npx @wordpress/env run cli wp eval "
      global \$post;
      \$post = get_page_by_path('faq');
      if (\$post) {
        setup_postdata(\$post);
        ob_start();
        do_action('wp_head');
        \$head = ob_get_clean();
        wp_reset_postdata();
        if (strpos(\$head, 'FAQPage') !== false) {
          echo 'FAQ Schema: FOUND' . PHP_EOL;
          preg_match('/<script type=\"application\/ld\+json\">(.*?)<\/script>/s', \$head, \$matches);
          if (!empty(\$matches[1])) {
            echo json_encode(json_decode(\$matches[1]), JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . PHP_EOL;
          }
        } else {
          echo 'FAQ Schema: NOT FOUND' . PHP_EOL;
        }
      }
    "
    ```

    **Step 5: Verify synced patterns (wp_block post type)**

    ```bash
    # Check synced patterns exist
    npx @wordpress/env run cli wp post list --post_type=wp_block --fields=ID,post_title,post_status

    # Should show at least 2 synced patterns:
    # - "Contact CTA - Synced"
    # - "Produktansvarsfraskrivelse - Synced"

    # Verify count
    npx @wordpress/env run cli wp post list --post_type=wp_block --format=count
    ```

    **Step 6: Verify custom blocks are registered**

    ```bash
    # List all smartvarme/* blocks
    npx @wordpress/env run cli wp eval "
      \$blocks = WP_Block_Type_Registry::get_instance()->get_all_registered();
      \$smartvarme_blocks = array_filter(array_keys(\$blocks), function(\$n) {
        return strpos(\$n, 'smartvarme/') === 0;
      });
      echo 'Registered smartvarme blocks:' . PHP_EOL;
      foreach (\$smartvarme_blocks as \$block) {
        echo '  - ' . \$block . PHP_EOL;
      }
      echo 'Total: ' . count(\$smartvarme_blocks) . PHP_EOL;
    "
    ```

    Expected output should include:
    - smartvarme/product-comparison
    - smartvarme/energy-calculator

    **Step 7: Verify test page with custom blocks**

    ```bash
    # Check if test page exists and loads
    npx @wordpress/env run cli wp post list --post_type=page --s="Test: Custom Blocks" --fields=ID,post_title,post_status

    # Get the URL and test it
    npx @wordpress/env run cli wp eval "
      \$page = get_page_by_title('Test: Custom Blocks');
      if (\$page) {
        \$url = get_permalink(\$page->ID);
        echo 'Test page URL: ' . \$url . PHP_EOL;
        \$response = wp_remote_get(\$url);
        echo 'Response code: ' . wp_remote_retrieve_response_code(\$response) . PHP_EOL;
      } else {
        echo 'Test page not found' . PHP_EOL;
      }
    "
    ```

    **Step 8: Verify Redirection plugin handles any needed redirects**

    ```bash
    npx @wordpress/env run cli wp eval "
      if (class_exists('Red_Item')) {
        \$redirects = Red_Item::get_all();
        echo 'Active redirects: ' . count(\$redirects) . PHP_EOL;
      } else {
        echo 'Redirection plugin class not available' . PHP_EOL;
      }
    "
    ```

    **Step 9: Fix any issues found**

    If any URL returns non-200, diagnose and fix:
    - 404: Check permalink structure, flush rewrite rules (`wp rewrite flush`)
    - 500: Check PHP error log, fix template issues
    - Wrong template: Verify template hierarchy naming

    Flush rewrite rules as a safety measure:
    ```bash
    npx @wordpress/env run cli wp rewrite flush
    ```
  </action>
  <verify>
    1. All 9 blog posts return HTTP 200
    2. FAQ page at /faq/ returns HTTP 200
    3. Key content pages return HTTP 200
    4. FAQ page head contains FAQPage JSON-LD schema
    5. No 404 or 500 errors on any content URL
    6. At least 2 wp_block posts exist (synced patterns)
    7. 2 smartvarme/* blocks registered (product-comparison, energy-calculator)
    8. Test page with custom blocks returns HTTP 200
  </verify>
  <done>
    All content URLs verified accessible. FAQ schema validates in page head. Synced patterns exist in database. Custom blocks registered in WordPress. Test page with custom blocks loads successfully. No broken links or error responses. Rewrite rules flushed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete Phase 2 content system</name>
  <files></files>
  <action>
    Present the completed Phase 2 content system to the user for verification. The system includes:
    1. 5 block patterns registered (FAQ section, hero, CTA, blog card grid, product features)
    2. Synced patterns enabled with 2 starter examples (Contact CTA, Product Disclaimer)
    3. FAQ page migrated from Kadence accordion to native WordPress Details blocks
    4. FAQPage JSON-LD schema markup on FAQ page
    5. Enhanced single post template with featured image and metadata
    6. Enhanced archive template with card grid layout
    7. Content styles (accordion, cards, typography)
    8. Product comparison custom block
    9. Energy calculator custom block

    User should perform the following tests:

    **Test 1: FAQ page (2 min)**
    1. Visit http://localhost:8080/faq/
    2. Verify all FAQ items display as expandable accordions
    3. Click each accordion -- should expand to show answer, click again to collapse
    4. View page source (Ctrl+U) -- search for "FAQPage" to confirm schema markup exists

    **Test 2: Blog post (1 min)**
    1. Visit http://localhost:8080/spar-penger-i-vinter-med-det-rette-ildstedet/
    2. Verify featured image displays at top (if post has one)
    3. Verify title, date, and category are visible
    4. Verify post navigation links at bottom

    **Test 3: Blog archive (1 min)**
    1. Visit http://localhost:8080/ (or the blog archive page)
    2. Verify posts display in a card-style grid layout
    3. Verify pagination works if more than 9 posts

    **Test 4: Block patterns in inserter (2 min)**
    1. Go to http://localhost:8080/wp-admin/post-new.php?post_type=page
    2. Click the "+" block inserter, then click "Patterns" tab
    3. Look for "Smartvarme" category in the pattern list
    4. Insert the "FAQ Section" pattern -- should add accordion Details blocks
    5. Insert the "Hero Section" pattern -- should add a full-width hero
    6. Insert the "Contact CTA" pattern -- should add Norwegian CTA block

    **Test 5: Synced patterns (3 min)**
    1. In the block editor, click "+" -> "Patterns" tab -> "My patterns" section
    2. Verify you see "Contact CTA - Synced" and "Produktansvarsfraskrivelse - Synced"
    3. Insert the "Contact CTA - Synced" pattern into the page
    4. Open a second tab with a new page, insert the same synced pattern
    5. In the first tab, click "Edit" on the synced pattern, change the text
    6. Save the first page
    7. Refresh the second tab -- verify the text changed there too (syncing works)

    **Test 6: Product comparison block (3 min)**
    1. Create a new page in wp-admin
    2. Click "+" and search for "produktsammenligning" or "product comparison"
    3. Insert the block -- should show placeholder text
    4. Open the sidebar (right panel) -- look for "Produkter å sammenligne" panel
    5. Click "Legg til produkt" to add 2-3 products to compare
    6. Select products from the dropdown (should list WooCommerce products)
    7. Save and preview the page
    8. Verify comparison table renders with product name, price, power, energy class, delivery time

    **Test 7: Energy calculator block (3 min)**
    1. In the same or new page, search for "energikalkulator" or "energy calculator"
    2. Insert the block -- should show calculator form preview
    3. Open sidebar -- verify you can adjust "Standard boligareal" and "Standard isolasjon"
    4. Save and preview the page
    5. Verify calculator form displays with inputs for house size and insulation
    6. Enter values (e.g., 120 m², medium insulation) and click "Beregn"
    7. Verify calculation result shows recommended kW
    8. Verify recommended products appear below (if products exist in WooCommerce)

    **Test 8: Create FAQ article test (2 min)**
    1. Create a new page in wp-admin
    2. Use the FAQ Section pattern to add an FAQ
    3. Edit the placeholder questions and answers
    4. Verify you can add more Details blocks manually
    5. Confirm editing feels intuitive (under 5 min for a new FAQ)
  </action>
  <verify>User responds with "approved" or describes issues to fix.</verify>
  <done>Human has verified the complete content editing workflow including: FAQ display, blog templates, pattern inserter (static patterns), synced patterns (global updates), product comparison block, energy calculator block, and overall content editing experience.</done>
</task>

</tasks>

<verification>
Phase 2 success criteria verification:
1. Content editor can create new FAQ article using Gutenberg block patterns in under 5 minutes -- verified by human test
2. Content editor can create new blog post using Gutenberg blocks without developer help -- verified by pattern availability
3. All existing FAQ articles from old site are accessible at their original URLs -- verified by URL checks
4. All existing blog posts from old site are accessible at their original URLs -- verified by URL checks
5. FAQ page renders FAQ schema markup -- verified by JSON-LD output in page source
6. Synced patterns work (edit in one place, update everywhere) -- verified by human test
7. Product comparison block functional -- verified by human test
8. Energy calculator block functional -- verified by human test
</verification>

<success_criteria>
- All 9 blog post URLs return HTTP 200
- FAQ page at /faq/ returns HTTP 200 with all 6 FAQ items
- FAQ schema JSON-LD present in page source with FAQPage type
- Block patterns visible in editor pattern inserter under Smartvarme category
- Synced patterns (wp_block post type) exist and accessible in "My patterns" section
- Custom blocks (smartvarme/product-comparison, smartvarme/energy-calculator) registered
- Test page with custom blocks renders successfully
- Human approves complete content editing workflow
- No PHP errors or broken layouts on content pages
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-system-migration/02-03-SUMMARY.md`
</output>
